<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      Home - Documentation
  </title>

  <link href="https://www.braintreepayments.com/images/favicon-ccda0b14.png" rel="icon" type="image/png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  
  <link type="text/css" rel="stylesheet" href="styles/collapse.css">
  

  

  <!-- start Mixpanel -->
  <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("1919205b2da72e4da3b9b6639b444d59");</script>
  <!-- end Mixpanel -->
</head>

<body>
  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <div class="top-nav-wrapper">
    <ul>
      <li  class="active" >
        <a href="index.html">
          
          
            <svg fill="#0095dd" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          
        </a>
      </li>

      

    </ul>
  </div>

  <nav>
    <h3 class="reference-title">
      Wavecore
    </h3>

    
      <h3>
        Resources
      </h3>
      
        <a href="https://github.com/hypercore-protocol/hypercore-next">hypercore v10</a>
      
        <a href="https://github.com/random-access-storage">random-access-storage</a>
      
        <a href="https://github.com/little-core-labs/nanoprocess">nanoprocess</a>
      
        <a href="https://github.com/storyboard-fm/little-media-box">little-media-box</a>
      
    

    <h3>Classes</h3><ul><li id="Wavecore-nav"><a href="Wavecore.html">Wavecore</a><ul class='methods'><li data-type="method" id="Wavecore-coreOpts-nav"><a href="Wavecore.html#.coreOpts">coreOpts</a></li><li data-type="method" id="Wavecore-fromCore-nav"><a href="Wavecore.html#.fromCore">fromCore</a></li><li data-type="method" id="Wavecore-fromRaw-nav"><a href="Wavecore.html#.fromRaw">fromRaw</a></li><li data-type="method" id="Wavecore-fromRec-nav"><a href="Wavecore.html#.fromRec">fromRec</a></li><li data-type="method" id="Wavecore-_fileBuffer-nav"><a href="Wavecore.html#_fileBuffer">_fileBuffer</a></li><li data-type="method" id="Wavecore-_nextZero-nav"><a href="Wavecore.html#_nextZero">_nextZero</a></li><li data-type="method" id="Wavecore-_rawStream-nav"><a href="Wavecore.html#_rawStream">_rawStream</a></li><li data-type="method" id="Wavecore-_rec-nav"><a href="Wavecore.html#_rec">_rec</a></li><li data-type="method" id="Wavecore-_volAdjust-nav"><a href="Wavecore.html#_volAdjust">_volAdjust</a></li><li data-type="method" id="Wavecore-addBlank-nav"><a href="Wavecore.html#addBlank">addBlank</a></li><li data-type="method" id="Wavecore-append-nav"><a href="Wavecore.html#append">append</a></li><li data-type="method" id="Wavecore-audioBuffer-nav"><a href="Wavecore.html#audioBuffer">audioBuffer</a></li><li data-type="method" id="Wavecore-close-nav"><a href="Wavecore.html#close">close</a></li><li data-type="method" id="Wavecore-concat-nav"><a href="Wavecore.html#concat">concat</a></li><li data-type="method" id="Wavecore-gain-nav"><a href="Wavecore.html#gain">gain</a></li><li data-type="method" id="Wavecore-has-nav"><a href="Wavecore.html#has">has</a></li><li data-type="method" id="Wavecore-monitor-nav"><a href="Wavecore.html#monitor">monitor</a></li><li data-type="method" id="Wavecore-norm-nav"><a href="Wavecore.html#norm">norm</a></li><li data-type="method" id="Wavecore-open-nav"><a href="Wavecore.html#open">open</a></li><li data-type="method" id="Wavecore-play-nav"><a href="Wavecore.html#play">play</a></li><li data-type="method" id="Wavecore-recStream-nav"><a href="Wavecore.html#recStream">recStream</a></li><li data-type="method" id="Wavecore-seek-nav"><a href="Wavecore.html#seek">seek</a></li><li data-type="method" id="Wavecore-session-nav"><a href="Wavecore.html#session">session</a></li><li data-type="method" id="Wavecore-shift-nav"><a href="Wavecore.html#shift">shift</a></li><li data-type="method" id="Wavecore-snapshot-nav"><a href="Wavecore.html#snapshot">snapshot</a></li><li data-type="method" id="Wavecore-split-nav"><a href="Wavecore.html#split">split</a></li><li data-type="method" id="Wavecore-stats-nav"><a href="Wavecore.html#stats">stats</a></li><li data-type="method" id="Wavecore-tag-nav"><a href="Wavecore.html#tag">tag</a></li><li data-type="method" id="Wavecore-tempo-nav"><a href="Wavecore.html#tempo">tempo</a></li><li data-type="method" id="Wavecore-truncate-nav"><a href="Wavecore.html#truncate">truncate</a></li><li data-type="method" id="Wavecore-vad-nav"><a href="Wavecore.html#vad">vad</a></li><li data-type="method" id="Wavecore-wav-nav"><a href="Wavecore.html#wav">wav</a></li></ul></li></ul>
  </nav>

  <div id="main">
    

    
      



    

      


  <section class="readme">
    <article>
      <h1>@storyboard-fm/wavecore</h1>
<p>A data structure for real-time reading, editing, seeking, and encoding of mono
WAV audio files via hypercore v10. Version control, branches, and peering come
for free thanks to the <a href="https://github.com/hypercore-protocol/hypercore-next"><code>hypercore@next</code></a> branch.</p>
<h2>Getting Started</h2>
<h3>Installation</h3>
<pre class="prettyprint source lang-sh"><code>$ npm install git+ssh://git@github.com:storyboard-fm/wavecore.git
</code></pre>
<h3>Status</h3>
<blockquote>
<p>WIP, expect breaking changes</p>
</blockquote>
<h3>Notes</h3>
<ul>
<li>As designed, some of this library's functionalities depend upon the <code>sox</code> and
<code>play</code> command-line tools. Installing <a href="http://sox.sourceforge.net/">SoX</a> is recommended.</li>
<li>The browser-compatible version of this module is in the <code>dev/web</code> branch.</li>
<li>Use signed 16-bit fixed integer mono PCM samples at 48kHz sampling rate</li>
<li>Raw and WAV both supported (for now) as inputs</li>
</ul>
<h2>Background</h2>
<p>This library's intent is to enable real-time peer-to-peer recording, editing, and
remixing of audio content without sacrificing fidelity, privacy, nor speed.</p>
<p>The WAV audio can be sourced from any valid instance of
<a href="https://github.com/random-access-storage"><code>random-access-storage</code></a> and can be therefore stored in memory as a
buffer, on S3 as a remote cloud URI, or as a file on the local file system. This
means it is functional on local offline-first client applications, server-side
applications, and web apps all from one codebase.</p>
<h3>Functionality</h3>
<h4>Create Operations</h4>
<blockquote>
<p>A Wavecore can be created from a number of inputs and sources; with no
arguments provided at all, a new Wavecore with sane defaults is provided.</p>
</blockquote>
<ul>
<li>[x] Create new Wavecore with no inputs</li>
<li>[x] Create new Wavecore with <a href="https://storyboard-fm.github.io/little-media-box/Source.html"><code>Source</code></a> input</li>
<li>[x] Create new Wavecore with <a href="https://github.com/hypercore-protocol/hypercore-next">hypercore</a> input</li>
<li>[x] Create new Wavecore from other Wavecore</li>
<li>[x] Create new Wavecore with <a href="https://github.com/random-access-storage"><code>random-access-storage</code></a> input</li>
</ul>
<h4>Write Operations</h4>
<ul>
<li>[x] Append</li>
<li>[x] Pad tail (Add blank data to tail to extend duration)</li>
</ul>
<h4>Editing Operations</h4>
<blockquote>
<p>Wavecore audio editing tasks mimic the methods offered by <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array">JavaScript
Arrays</a></p>
</blockquote>
<ul>
<li>[x] Trim: <a href="https://storyboard-fm.github.io/wavecore/Wavecore.html#shift">shift</a></li>
<li>[x] Trim: <a href="https://storyboard-fm.github.io/wavecore/Wavecore.html#truncate">truncate</a></li>
<li>[x] <a href="https://storyboard-fm.github.io/wavecore/Wavecore.html#split">Split</a></li>
<li>[x] <a href="https://storyboard-fm.github.io/wavecore/Wavecore.html#concat">Join</a></li>
</ul>
<h4>Timeline Operations</h4>
<ul>
<li>[x] <a href="https://storyboard-fm.github.io/wavecore/Wavecore.html#play">Playback</a></li>
<li>[x] <a href="https://storyboard-fm.github.io/wavecore/Wavecore.html#seek">Seeking</a></li>
</ul>
<h4>DSP Operations</h4>
<ul>
<li>[x] <a href="https://storyboard-fm.github.io/wavecore/Wavecore.html#gain">Gain</a></li>
<li>[x] <a href="https://storyboard-fm.github.io/wavecore/Wavecore.html#norm">Normalization</a></li>
<li>[x] <a href="https://storyboard-fm.github.io/wavecore/Wavecore.html#tempo">Time Stretch</a></li>
</ul>
<h4>Helper Functions</h4>
<ul>
<li>[x] <a href="https://storyboard-fm.github.io/wavecore/Wavecore.html#session">Sessions</a></li>
<li>[x] <a href="https://storyboard-fm.github.io/wavecore/Wavecore.html#snapshot">Snapshots</a></li>
</ul>
<h4>Analysis Operations</h4>
<ul>
<li>[x] SoX <code>stat</code></li>
<li>[x] SoX <code>stats</code></li>
<li>[ ] SoX <code>spectrogram</code></li>
<li>[ ] <code>audiowaveform</code> peaks data</li>
<li>[ ] <code>aubioonset</code> onset timing</li>
<li>[ ] <code>fpcalc</code> fingerprint</li>
</ul>
<h4>Tagging Operations</h4>
<ul>
<li>[x] RIFF <a href="https://storyboard-fm.github.io/wavecore/Wavecore.html#tag">tags</a></li>
<li>[ ] BWF tags</li>
<li>[ ] Cue points (in progress)</li>
</ul>
<h4>P2P</h4>
<ul>
<li>[ ] Replication between Wavecores</li>
</ul>
<h3>Design</h3>
<h4>Mono WAV Only</h4>
<p>There were several factors influencing the decision to support only mono WAV
data. Most notably, the Web Audio API's <code>AudioBuffer.getChannelData()</code> method,
as its name suggests, loads audio data one channel at a time. Wavecore audio
data can therefore be easily loaded inline with that method, querying it for
specific data ranges before having to allocate buffer resources.</p>
<p>By forcing all Wavecores to be mono-first, we also enable different processing to
occur on each channel of audio without worrying about data interleaving.</p>
<h2>Examples</h2>
<h3>Recording Into A Wavecore</h3>
<h4><a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaRecorder"><code>MediaRecorder</code></a></h4>
<h5>Stream-based</h5>
<pre class="prettyprint source lang-js"><code>const mr = new MediaRecorder(stream)
const wave = new Wavecore()
wave.recStream(mr.stream)
// Optionally, monitor the Wavecore's input as it streams in:
// wave.monitor()
</code></pre>
<h5>Event-based</h5>
<pre class="prettyprint source lang-js"><code>const core = new Hypercore(ram)
mediaRecorder.onstop = function() {
  const wave = new Wavecore({ core })
}
mediaRecorder.ondataavailable = function(d) {
  core.append(d.data)
}
</code></pre>
<h4>CLI</h4>
<pre class="prettyprint source lang-js"><code>// Will record your microphone for 30 minutes
const recording = Wavecore.fromRec(&quot;30:00&quot;)
// Write the audio to your local disk and listen in real-time!
recording.liveStream.pipe(fs.createWriteStream('liverecording.wav'))
</code></pre>
<h3>Playing A Wavecore</h3>
<h4>Play Indexed Audio Data</h4>
<pre class="prettyprint source lang-js"><code>const wavecore = new Wavecore({ source })
await wavecore.open()
wavecore.play({start: 5, end: 13}) // Play indeces 5 through 13
</code></pre>
<h4>Listen For Live Audio Updates</h4>
<blockquote>
<p>Listen to the audio being inserted in the Wavecore <strong>in real-time!</strong>
<em><strong>Yes, you read that correctly: REAL-TIME!</strong></em></p>
</blockquote>
<pre class="prettyprint source lang-js"><code>const wavecore = new Wavecore({ source })
await wavecore.open()
const waveStream = wavecore._liveStream()
// Consume this ReadableStream to listen to the audio as it gets recorded into
// the Wavecore!
</code></pre>
<h3>Editing Operations</h3>
<h4>Editing Sessions &amp; Snapshots</h4>
<p>Here we make a snapshot of our Wavecore so we can test out an edit to the WAV
audio. By using our new session to test the edit we leave the original Wavecore
audio in-tact, enabling non-destructive editing with no additional memory
allocation necessary!</p>
<pre class="prettyprint source lang-js"><code>const Wavecore = require('@storyboard-fm/wavecore')
const source = new Source('./test/test.wav.raw')

const wave = new Wavecore({ source })
await wave.open()

const snapshot = wave.snapshot()
await wave.truncate(10)

console.log(wave.core.length) // 10
console.log(snapshot.core.length) // 58
</code></pre>
<h4>Trimming Audio</h4>
<h5>Trim From Beginning</h5>
<p>The following trims a Wavecore to start on the 20th index.</p>
<pre class="prettyprint source lang-js"><code>const { Source } = require('@storyboard-fm/little-media-box')
const Wavecore = require('@storyboard-fm/wavecore')
const source = new Source('./test.wav')
const wave = new Wavecore({ source })

await wave.open()
console.log(wave.core.length) // 58
const shiftedCore = await Promise.resolve(wave.shift(20))
console.log(shiftedCore.length) // 38
</code></pre>
<h5>Trim From End</h5>
<p>The following truncates a Wavecore to the first 20 indeces.</p>
<pre class="prettyprint source lang-js"><code>const { Source } = require('@storyboard-fm/little-media-box')
const Wavecore = require('@storyboard-fm/wavecore')
const source = new Source('./test.wav')
const wave = new Wavecore({ source })

await wave.open()
console.log(wave.core.length) // 58
await wave.truncate(20)
console.log(wave.core.length) // 20
</code></pre>
<h4>Splitting Audio</h4>
<p>Execute this script at <code>example2.js</code>.</p>
<pre class="prettyprint source lang-js"><code>const { Source } = require('@storyboard-fm/little-media-box')
const Wavecore = require('.')

const source = new Source('./test/test.wav')
const w = new Wavecore({ source })

async function main() {
  await w.open()
  console.log('splitting Wavecore at index 22....')
  const [head, tail] = await w.split(22)
  console.log('done!', head, tail)
}

main()
</code></pre>
<h3>Signal Processing</h3>
<h4>Gain (+ Limiting)</h4>
<blockquote>
<p>Increase gain by +6dBFS and add a limiter to prevent clipping</p>
</blockquote>
<pre class="prettyprint source lang-js"><code>const wave = new Wavecore({ source })
await wave.open()
const gainUp = await wave.gain('+6', {limiter:true})
</code></pre>
<h4>Normalization</h4>
<blockquote>
<p>Increase gain so that the peak dBFS value = 0</p>
</blockquote>
<pre class="prettyprint source lang-js"><code>const wave = new Wavecore({ source })
await wave.open()
await wave.norm()
</code></pre>
<h4>Playback Rate</h4>
<blockquote>
<p>Change the &quot;tempo&quot; of the audio without changing the pitch</p>
</blockquote>
<pre class="prettyprint source lang-js"><code>const wave = new Wavecore({ source })
await wave.open()
const snap = wave.snapshot() // save copy of original audio
const slowerWave = await Promise.resolve(wave.tempo(0.8)) // 20% slower
const fasterWave = await Promise.resolve(wave.tempo(1.1)) // 10% faster
</code></pre>
<h2>Tests</h2>
<table>
<thead>
<tr>
<th>Statements</th>
<th>Branches</th>
<th>Functions</th>
<th>Lines</th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="https://img.shields.io/badge/statements-78.42%25-red.svg?style=flat" alt="Statements"></td>
<td><img src="https://img.shields.io/badge/branches-62.79%25-red.svg?style=flat" alt="Branches"></td>
<td><img src="https://img.shields.io/badge/functions-83.5%25-yellow.svg?style=flat" alt="Functions"></td>
<td><img src="https://img.shields.io/badge/lines-85.13%25-yellow.svg?style=flat" alt="Lines"></td>
</tr>
</tbody>
</table>
<p>We use <code>mocha</code>, with <code>nyc</code> for test coverage reporting.</p>
<pre class="prettyprint source lang-sh"><code>$ npm run test
</code></pre>
    </article>
  </section>


    


  </div>

  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a>
  </footer>

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>

  

</body>
</html>